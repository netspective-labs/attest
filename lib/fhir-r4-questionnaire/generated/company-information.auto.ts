/**
 * @file company-information.auto.ts
 * @generated This file was auto-generated at 2025-08-17T01:00:18.920Z from the FHIR R4 Questionnaire "Company Information".
 * Do not edit this file manually; re-run the generator if the source Questionnaire changes.
 * Profiles: http://hl7.org/fhir/4.0/StructureDefinition/Questionnaire
 *
 * Normalizes LHC JSON and FHIR QuestionnaireResponse into the type-safe `CompanyInformation` interface.
 */

// deno-lint-ignore no-explicit-any
type Any = any;
import {
  coerceOptionalDate,
  coerceOptionalString,
  coerceString,
  findLhcValueByLinkId,
  findQrAnswerByLinkId,
  isBlank,
} from "../r4q-runtime.ts";
/**
 * Form Help (from display/help controls):
 * - Provide essential information about your organization for CMMC compliance tracking.
 */
/** Map of normalized property names to their source `linkId`. */
export const CompanyInformationLinkIds = {
  organizationName: "715544477968",
  formCompletedBy: "655141523763",
  positionTitle: "761144039651",
  emailAddress: "441278853405",
  workPhone: "375736159279",
  mobilePhone: "948589414714",
  assessmentDate: "276403539223",
  industry: "789286873476",
  employeeCount: "697235963218",
  contractTypes: "863463230823",
  cageCode: "805221373063",
  dunsNumber: "374784155003",
} as const;

/** Normalized view of "Company Information" answers. */
export interface CompanyInformation {
  /**
   * Organization Name
   * linkId: 715544477968
   * FHIR type: string
   * Entry format: Enter your organization name
   * Required: yes
   */
  organizationName: string;

  /**
   * Form Completed By
   * linkId: 655141523763
   * FHIR type: string
   * Entry format: Your full name
   * Required: yes
   */
  formCompletedBy: string;

  /**
   * Position/Title
   * linkId: 761144039651
   * FHIR type: string
   * Entry format: Your job title
   * Required: no
   */
  positionTitle?: string;

  /**
   * Email Address
   * linkId: 441278853405
   * FHIR type: string
   * Entry format: your.email@company.com
   * Required: yes
   */
  emailAddress: string;

  /**
   * Work Phone
   * linkId: 375736159279
   * FHIR type: string
   * Entry format: (555) 121-2345
   * Required: yes
   */
  workPhone: string;

  /**
   * Mobile Phone
   * linkId: 948589414714
   * FHIR type: string
   * Entry format: (555) 987-4756
   * Required: yes
   */
  mobilePhone: string;

  /**
   * Assessment Date
   * linkId: 276403539223
   * FHIR type: date
   * Required: no
   */
  assessmentDate?: Date;

  /**
   * Industry
   * linkId: 789286873476
   * FHIR type: string
   * Entry format: Defense, Technology, etc.
   * Required: no
   */
  industry?: string;

  /**
   * Employee Count
   * linkId: 697235963218
   * FHIR type: string
   * Entry format: 1-10, 11-50, 51-200, etc.
   * Required: no
   */
  employeeCount?: string;

  /**
   * Contract Types
   * linkId: 863463230823
   * FHIR type: text
   * Entry format: Prime contracts, subcontracts, etc. (comma-separated)
   * Required: no
   */
  contractTypes?: string;

  /**
   * CAGE Code
   * linkId: 805221373063
   * FHIR type: string
   * Entry format: 5-character CAGE code
   * Section: Organization Identifiers
   * Required: no
   */
  cageCode?: string;

  /**
   * DUNS Number
   * linkId: 374784155003
   * FHIR type: string
   * Entry format: 9-digit DUNS number
   * Section: Organization Identifiers
   * Required: no
   */
  dunsNumber?: string;
}

/** Convert an LHC JSON response into a normalized CompanyInformation object. */
export function companyInformationLhcFormResponseAdapter(
  input: Any,
): CompanyInformation {
  return {
    organizationName: coerceString(findLhcValueByLinkId(input, "715544477968")),
    formCompletedBy: coerceString(findLhcValueByLinkId(input, "655141523763")),
    positionTitle: coerceOptionalString(
      findLhcValueByLinkId(input, "761144039651"),
    ),
    emailAddress: coerceString(findLhcValueByLinkId(input, "441278853405")),
    workPhone: coerceString(findLhcValueByLinkId(input, "375736159279")),
    mobilePhone: coerceString(findLhcValueByLinkId(input, "948589414714")),
    assessmentDate: coerceOptionalDate(
      findLhcValueByLinkId(input, "276403539223"),
    ),
    industry: coerceOptionalString(findLhcValueByLinkId(input, "789286873476")),
    employeeCount: coerceOptionalString(
      findLhcValueByLinkId(input, "697235963218"),
    ),
    contractTypes: coerceOptionalString(
      findLhcValueByLinkId(input, "863463230823"),
    ),
    cageCode: coerceOptionalString(findLhcValueByLinkId(input, "805221373063")),
    dunsNumber: coerceOptionalString(
      findLhcValueByLinkId(input, "374784155003"),
    ),
  };
}

/** Convert a FHIR QuestionnaireResponse into a normalized CompanyInformation object. */
export function companyInformationFhirQuestionnaireResponseAdapter(
  qr: Any,
): CompanyInformation {
  return {
    organizationName: coerceString(findQrAnswerByLinkId(qr, "715544477968")),
    formCompletedBy: coerceString(findQrAnswerByLinkId(qr, "655141523763")),
    positionTitle: coerceOptionalString(
      findQrAnswerByLinkId(qr, "761144039651"),
    ),
    emailAddress: coerceString(findQrAnswerByLinkId(qr, "441278853405")),
    workPhone: coerceString(findQrAnswerByLinkId(qr, "375736159279")),
    mobilePhone: coerceString(findQrAnswerByLinkId(qr, "948589414714")),
    assessmentDate: coerceOptionalDate(
      findQrAnswerByLinkId(qr, "276403539223"),
    ),
    industry: coerceOptionalString(findQrAnswerByLinkId(qr, "789286873476")),
    employeeCount: coerceOptionalString(
      findQrAnswerByLinkId(qr, "697235963218"),
    ),
    contractTypes: coerceOptionalString(
      findQrAnswerByLinkId(qr, "863463230823"),
    ),
    cageCode: coerceOptionalString(findQrAnswerByLinkId(qr, "805221373063")),
    dunsNumber: coerceOptionalString(findQrAnswerByLinkId(qr, "374784155003")),
  };
}

/** High-level interpreter with factories, validation, and readiness scoring. */
export class CompanyInformationInterpreter {
  constructor(readonly value: CompanyInformation) {}

  /** Factory: build from LHC JSON. */
  static fromLhcFormResponse(input: Any): CompanyInformationInterpreter {
    return new CompanyInformationInterpreter(
      companyInformationLhcFormResponseAdapter(input),
    );
  }

  /** Factory: build from FHIR QuestionnaireResponse. */
  static fromQuestionnaireResponse(qr: Any): CompanyInformationInterpreter {
    return new CompanyInformationInterpreter(
      companyInformationFhirQuestionnaireResponseAdapter(qr),
    );
  }

  /** Check required fields and report any missing or blank. */
  validateRequiredFields(): {
    ok: boolean;
    missing: Array<keyof CompanyInformation>;
  } {
    const missing: Array<keyof CompanyInformation> = [];
    const req: Array<keyof CompanyInformation> = [
      "organizationName",
      "formCompletedBy",
      "emailAddress",
      "workPhone",
      "mobilePhone",
    ];
    for (const k of req) {
      const v = (this.value as Any)[k];
      if (isBlank(v)) missing.push(k);
    }
    return { ok: missing.length === 0, missing };
  }

  /**
   * Assess readiness with a simple completeness score. This is meant to be
   * used to help understand how complete the types are and serves as an
   * example of how to use the generated code.
   * - requiredCovered: percentage of required fields that are non-blank
   * - overallFilled: count of non-blank fields among all known properties
   */
  assessReadiness(): {
    formTitle: string;
    requiredCovered: number; // 0..1
    totalRequired: number;
    totalFilled: number;
    totalFields: number;
    missingRequired: Array<keyof CompanyInformation>;
  } {
    const req: Array<keyof CompanyInformation> = [
      "organizationName",
      "formCompletedBy",
      "emailAddress",
      "workPhone",
      "mobilePhone",
    ];
    const all: Array<keyof CompanyInformation> = [
      "organizationName",
      "formCompletedBy",
      "positionTitle",
      "emailAddress",
      "workPhone",
      "mobilePhone",
      "assessmentDate",
      "industry",
      "employeeCount",
      "contractTypes",
      "cageCode",
      "dunsNumber",
    ];

    let reqFilled = 0;
    const missingReq: Array<keyof CompanyInformation> = [];
    for (const k of req) {
      const v = (this.value as Any)[k];
      if (!isBlank(v)) reqFilled++;
      else missingReq.push(k);
    }

    let totalFilled = 0;
    for (const k of all) {
      if (!isBlank((this.value as Any)[k])) totalFilled++;
    }

    return {
      formTitle: "Company Information",
      requiredCovered: req.length ? reqFilled / req.length : 1,
      totalRequired: req.length,
      totalFilled,
      totalFields: all.length,
      missingRequired: missingReq,
    };
  }
}
